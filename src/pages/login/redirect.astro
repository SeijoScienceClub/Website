---
const code = Astro.url.searchParams.get("code");
console.log(code);
let grantAccess: typeGrantAccess = {};
interface typeGrantAccess {
  access_token?: String;
  token_type?: String;
  expires_in?: Number;
  refresh_token?: String;
  scope?: String;
}
let userData: typeUserData = {};
interface typeUserData {
  avatar?: String;
  banner?: String;
  email?: String;
  global_name?: String;
  id?: String;
  username?: String;
}
fetch("https://discordapp.com/api/oauth2/token", {
  method: "POST",
  body: new URLSearchParams({
    client_id: "1319225068592824411",
    client_secret: process.env.DISCORD_CLIENT_SECRET || "",
    grant_type: "authorization_code",
    code: `${code}`,
    redirect_uri: "https://seijoscience.com/login/redirect",
  }),
})
  .then((response) => {
    response.json().then((response) => {
      grantAccess = response;
    });
  })
  .then(() => {
    fetch("https://discordapp.com/api/users/@me", {
      headers: {
        Authorization: `Bearer ${grantAccess.access_token}`,
      },
    }).then((response) => {
      response.json().then((response) => {
        userData = response;
      });
    });
  });
---

<p>This is your data.</p>
<ul>
  <li>Username:{userData.global_name}</li>
  <li>UserID:{userData.username}</li>
  <li>Email:{userData.email}</li>
  <li>
    Avatar:<img
      src={"https://cdn.discordapp.com/avatars/" +
        userData.id +
        "/" +
        userData.avatar}
      alt="avatar"
    />
  </li>
  <li>
    Banner:<img
      src={"https://cdn.discordapp.com/banners/" +
        userData.id +
        "/" +
        userData.banner}
      alt="banner"
    />
  </li>
  <li>SnowflakeID:{userData.id}</li>
</ul>
